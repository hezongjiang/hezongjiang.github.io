---
title: 抢红包算法
catalog: true
date: 2019-11-19 11:12:08
subtitle:
header-img: timg.jpeg
tags: 计算机基础
---

抢红包大家都知道，但发出一个固定金额的红包，由若干个人来抢，需要满足哪些规则？

1. 所有人抢到金额之和等于红包金额，不能超过，也不能少于。
2. 每个人至少抢到一分钱。
3. 要保证所有人抢到金额的几率相等。

下面实现了两种抢红包的方法：二倍均值法 和 线段切割法。

## 1、二倍均值法

设剩余红包金额为M，剩余人数为N，那么有如下公式：`每次抢到的金额 = Random(0, M / N * 2)`。

这个公式，保证了每次随机金额的平均值是相等的，不会因为抢红包的先后顺序而造成不公平。

举个栗子：

假设有10个人，红包总额100元。

100 / 10 * 2 = 20，所以第一个人的随机范围是（0，20)，平均可以抢到 10 元。假设第一个人随机到 10 元，那么剩余金额是100 - 10 = 90 元。

90 / 9 * 2 = 20，所以第二个人的随机范围同样是（0，20 )，平均可以抢到 10 元。假设第二个人随机到10元，那么剩余金额是90-10 = 80 元。

80/8X2 = 20, 所以第三个人的随机范围同样是（0，20 )，平均可以抢到10元。

以此类推，除了最后一次，每一次随机范围的均值是相等的。

```
List<Integer> divideRedPackage(int totalAmount, int totalPeopleNum) {
        List<Integer> results = new ArrayList<>(totalPeopleNum);
        int restAmount = totalAmount;
        int restPeopleNum = totalPeopleNum;
        Random random = new Random();
        for (int i = 0; i < totalPeopleNum - 1; i++) {
            int amount = random.nextInt(restAmount / restPeopleNum * 2 - 1) + 1;
            restAmount -= amount;
            restPeopleNum--;
            results.add(amount);
        }
        results.add(restAmount);
        return results;
}
```

## 2、线段切割法

何谓线段切割法？我们可以把红包总金额想象成一条很长的线段，而每个人抢到的金额，则是这条主线段所拆分出的若干子线段。

如何确定每一条子线段的长度呢？由“切割点”来决定。当 N 个人一起抢红包的时候，就需要确定 N-1 个切割点。因此，我们需要做 N-1 次随机运算，以此确定 N-1 个切割点。随机的范围区间是（1， M）。

当所有切割点确定以后，子线段的长度也随之确定。这样每个人来抢红包的时候，只需要顺次领取与子线段长度等价的红包金额即可。

这就是线段切割法的思路。在这里需要注意以下两点：
1. 当随机切割点出现重复，如何处理。
2. 如何尽可能降低时间复杂度和空间复杂度。

```
List<Integer> lineCut(int money, int people) {

        if (money < 1 || people < 1 || money < people) return;

        List<Integer> team = new ArrayList<>(people - 1);
        List<Integer> result = new ArrayList<>(people);

        Random random = new Random();
        while (team.size() < people - 1) {
            int randomMoney = random.nextInt(money) + 1;
            if (!team.contains(randomMoney)) {
                team.add(randomMoney);
            }
        }

        Collections.sort(team);

        System.out.print("分割点：");
        System.out.println(team);

        int left = 0;
        for (int i = 0; i < team.size(); i++) {
            result.add(team.get(i) - left);
            left = team.get(i);
        }
        result.add(money - left);

        System.out.print("每人金额：");
        System.out.println(result);

        // 验证分割后的数是否是输入的总金额
        Optional<Integer> r = result.stream().reduce(Integer::sum);
        System.out.print("总金额：");
        System.out.println(r.get());
        return result;
}
```

*参考[《漫画：如何实现抢红包算法？》](https://mp.weixin.qq.com/s?__biz=MzIxMjE5MTE1Nw==&mid=2653193719&idx=1&sn=64f184d36af9ef6393998fe5ea79329c&chksm=8c99f72dbbee7e3b3f00e067613c15144ce3624782161bd668ac57943d6aa198f1cebed8a050&scene=21#wechat_redirect)*
